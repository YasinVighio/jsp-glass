# JSP Debug Extension - Troubleshooting Guide

## Common Issues and Solutions

### 1. "Servlet source not found" Error

This error occurs when the extension cannot locate the compiled servlet files. Here's how to debug:

#### Check Debug Output
1. Open VS Code Developer Console (`Help > Toggle Developer Tools`)
2. Look for `JSP Debug:` messages in the console
3. The messages will show exactly where the extension is looking for servlet files

#### Verify Tomcat Configuration
Ensure your `config.json` includes:
```json
{
  "tomcatHome": "C:\\path\\to\\tomcat",
  "tomcatBase": "C:\\path\\to\\tomcat", 
  "compileJsp": true,
  "keepGenerated": true
}
```

#### Check Servlet Files Exist
1. Start your Tomcat server
2. Access your JSP pages in a browser (this triggers compilation)
3. Check if servlet files exist in: `{tomcatBase}/work/Catalina/localhost/{context}/org/apache/jsp/`
4. Look for files like `index_jsp.java` and `index_jsp.class`

#### Verify Tomcat JSP Compilation Settings
Add these to your Tomcat's web.xml or context.xml:
```xml
<servlet>
  <servlet-name>jsp</servlet-name>
  <servlet-class>org.apache.jasper.servlet.JspServlet</servlet-class>
  <init-param>
    <param-name>keepgenerated</param-name>
    <param-value>true</param-value>
  </init-param>
  <init-param>
    <param-name>development</param-name>
    <param-value>true</param-value>
  </init-param>
</servlet>
```

### 2. Breakpoints Not Working

#### Enable Java Debug
1. Ensure you have the Java Extension Pack installed
2. Start Tomcat with debug parameters: `-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8000`
3. Use "Attach to Java" debug configuration before setting JSP breakpoints

#### Check File Paths
1. Verify your workspace contains the JSP files
2. Ensure the webapp path in config.json matches your project structure
3. Check that relative paths are calculated correctly

### 3. Path Issues on Windows

#### Use Forward Slashes
In config.json, use forward slashes or escape backslashes:
```json
"tomcatHome": "C:/apache-tomcat-9.0.54"
// OR
"tomcatHome": "C:\\\\apache-tomcat-9.0.54"
```

#### Check Case Sensitivity
Ensure directory names match exactly (Windows is case-insensitive but paths must match)

### 4. Debug Console Messages

The extension provides detailed logging. Key messages to look for:

- `JSP Debug: Finding servlet class for JSP: {path}` - Shows which JSP is being mapped
- `JSP Debug: Servlet directory: {path}` - Shows where extension looks for servlet files  
- `JSP Debug: Servlet directory exists: {boolean}` - Whether the directory exists
- `JSP Debug: Contents of servlet directory:` - Lists actual files found
- `JSP Debug: Looking for class file: {path}` - Exact file path being checked

### 5. Manual Verification Steps

1. **Verify Tomcat Setup:**
   ```
   {tomcatBase}/work/Catalina/localhost/{context}/org/apache/jsp/
   ```

2. **Check Servlet Files:**
   - `index_jsp.java` (source)
   - `index_jsp.class` (compiled)

3. **Test JSP Compilation:**
   - Access JSP in browser
   - Check if servlet files are generated
   - Verify timestamps match

4. **Check Debug Configuration:**
   - Java debugger attached
   - Correct debug port (8000)
   - Tomcat started with debug flags

### 6. Example Working Setup

**Directory Structure:**
```
MyProject/
├── src/main/webapp/
│   ├── index.jsp
│   └── pages/
│       └── user.jsp
└── .vscode/
    └── config.json
```

**config.json:**
```json
{
  "tomcatHome": "C:/apache-tomcat-9.0.54",
  "tomcatBase": "C:/apache-tomcat-9.0.54",
  "webapps": [
    {
      "name": "myapp",
      "path": "C:/MyProject/src/main/webapp",
      "context": "myapp"
    }
  ],
  "debugPort": 8000,
  "compileJsp": true,
  "keepGenerated": true
}
```

**Expected Servlet Files:**
```
C:/apache-tomcat-9.0.54/work/Catalina/localhost/myapp/org/apache/jsp/
├── index_jsp.java
├── index_jsp.class
└── pages/
    ├── user_jsp.java
    └── user_jsp.class
```

### 7. Getting Help

If you're still having issues:

1. Check the VS Code Developer Console for detailed debug messages
2. Verify your Tomcat configuration matches the examples above
3. Ensure servlet files are actually being generated by Tomcat
4. Test with a simple JSP file first (like index.jsp)

The extension provides extensive debug logging to help identify exactly where the issue occurs.