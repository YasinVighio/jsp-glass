# Implementation

## Problem

Breakpoints in JSP need mapping to servlet lines.

## Solution

SMAP embedded in servlet classes by Tomcat. Extract with javap, use for mapping.

## How

Set JSP breakpoint, find servlet, extract SMAP, map line, set servlet breakpoint. During debug map servlet frames back to JSP.

## Files

extension.ts - Entry point
configurationManager.ts - Config and paths
jspMapper.ts - SMAP extraction and mapping
breakpointManager.ts - Breakpoint translation
debugTracker.ts - Stack frame interception
debugConfigurationProvider.ts - Debug config
debugAdapter.ts - Adapter hooks

## SMAP

```
SMAP
index_jsp.java
JSP
*L
1,5:50
7:56
*E
```

1,5:50 means JSP lines 1-5 map to servlet lines 50-54
7:56 means JSP line 7 maps to servlet line 56

## Mapping

For 7,52:128 JSP lines 7-58 map to servlet 128-179
Map JSP 10: offset 10-7=3, servlet 128+3=131
Map servlet 131: offset 131-128=3, JSP 7+3=10

## Why SMAP

Generated by Tomcat not guessed
Embedded in bytecode
JSR-45 standard
Always accurate
